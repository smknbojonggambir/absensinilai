<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Aplikasi Absensi & Nilai</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body class="login-body">
  <!-- LOGIN -->
  <div id="loginPage" class="login-box">
    <h1>Login Admin</h1>
    <form id="loginForm">
      <input type="text" id="username" placeholder="Username" required />
      <input type="password" id="password" placeholder="Password" required />
      <button type="submit">Masuk</button>
    </form>
    <p id="loginError"></p>
  </div>

  <!-- DASHBOARD -->
  <div id="dashboardPage" class="dashboard hidden">
    <h2>Selamat Datang, Admin</h2>
    <div class="menu-grid">
      <button onclick="showPage('absensiPage')" class="menu-card">Input Absensi</button>
      <button onclick="showPage('nilaiPage')" class="menu-card">Input Nilai</button>
      <button onclick="showPage('laporanPage')" class="menu-card">Lihat Laporan</button>
      <button onclick="logout()" class="menu-card danger">Keluar</button>
    </div>
  </div>

  <!-- ABSENSI -->
  <div id="absensiPage" class="form-container hidden">
    <h2>Form Absensi</h2>
    <form id="absensiForm">
      <input type="month" id="bulan" required>
      <input type="date" id="tanggal" required>
      <select id="nama" required></select>
      <select id="kelas" required></select>
      <select id="mapel">
        <option>Dasar-dasar DKV</option>
        <option>Informatika</option>
      </select>
      <select id="status">
        <option>Hadir</option>
        <option>Izin</option>
        <option>Sakit</option>
        <option>Alpha</option>
      </select>
      <button type="submit">Simpan</button>
    </form>
    <button onclick="showPage('dashboardPage')">Kembali ke Dashboard</button>
    <div id="absensiData"></div>
  </div>

  <!-- NILAI -->
  <div id="nilaiPage" class="form-container hidden">
    <h2>Form Nilai</h2>
    <form id="nilaiForm">
      <input type="month" id="bulanNilai" required>
      <select id="namaNilai" required></select>
      <select id="kelasNilai" required></select>
      <select id="mapelNilai">
        <option>Dasar-dasar DKV</option>
        <option>Informatika</option>
      </select>
      <input type="number" id="tugas1" placeholder="Tugas 1" required>
      <input type="number" id="tugas2" placeholder="Tugas 2" required>
      <input type="number" id="ulangan" placeholder="Ulangan" required>
      <input type="number" id="praktek" placeholder="Praktek" required>
      <button type="submit">Simpan</button>
    </form>
    <button onclick="showPage('dashboardPage')">Kembali ke Dashboard</button>
    <div id="nilaiData"></div>
  </div>

  <!-- LAPORAN -->
  <div id="laporanPage" class="form-container hidden">
    <h2>Laporan Absensi dan Nilai</h2>
    <button onclick="showPage('dashboardPage')">Kembali ke Dashboard</button>
    <div id="laporanAbsensi"></div>
    <div id="laporanNilai"></div>
  </div>

  <script>
  const scriptURL = 'https://script.google.com/macros/s/AKfycbzQIH6WrrYa2y9sfxgw7_kujhmFgs9rCoSYbfTmmfSoJhr1aEvHmbvyjoTXPpvWXHxT/exec';

  document.addEventListener('DOMContentLoaded', () => {
    showPage('loginPage');
    fetchSiswa();
  });

  const loginForm = document.getElementById('loginForm');
  if (loginForm) {
    loginForm.addEventListener('submit', function (e) {
      e.preventDefault();
      const user = document.getElementById('username').value;
      const pass = document.getElementById('password').value;
      if (user === 'admin' && pass === '12345') {
        showPage('dashboardPage');
      } else {
        document.getElementById('loginError').textContent = 'Login gagal';
      }
    });
  }

  function showPage(pageId) {
    document.querySelectorAll('body > div').forEach(el => el.classList.add('hidden'));
    document.getElementById(pageId).classList.remove('hidden');
  }

  function logout() {
    showPage('loginPage');
  }

  function fetchSiswa() {
    fetch(`${scriptURL}?action=getsiswa`)
      .then(res => res.json())
      .then(data => {
        const namaList = [document.getElementById('nama'), document.getElementById('namaNilai')];
        const kelasList = [document.getElementById('kelas'), document.getElementById('kelasNilai')];
        data.forEach(siswa => {
          namaList.forEach(namaSel => {
            if (namaSel) {
              const opt = document.createElement('option');
              opt.value = siswa.nama;
              opt.textContent = siswa.nama;
              namaSel.appendChild(opt);
            }
          });
          kelasList.forEach(kelasSel => {
            if (kelasSel && ![...kelasSel.options].some(o => o.value === siswa.kelas)) {
              const opt = document.createElement('option');
              opt.value = siswa.kelas;
              opt.textContent = siswa.kelas;
              kelasSel.appendChild(opt);
            }
          });
        });
      });
  }

  const absensiForm = document.getElementById('absensiForm');
  if (absensiForm) {
    absensiForm.addEventListener('submit', e => {
      e.preventDefault();
      const data = {
        action: 'addAbsensi',
        bulan: document.getElementById('bulan').value,
        tanggal: document.getElementById('tanggal').value,
        nama: document.getElementById('nama').value,
        kelas: document.getElementById('kelas').value,
        mapel: document.getElementById('mapel').value,
        status: document.getElementById('status').value
      };
      fetch(scriptURL, {
        method: 'POST',
        body: JSON.stringify(data)
      }).then(res => res.text()).then(alert);
    });
  }

  const nilaiForm = document.getElementById('nilaiForm');
  if (nilaiForm) {
    nilaiForm.addEventListener('submit', e => {
      e.preventDefault();
      const data = {
        action: 'addNilai',
        bulan: document.getElementById('bulanNilai').value,
        nama: document.getElementById('namaNilai').value,
        kelas: document.getElementById('kelasNilai').value,
        mapel: document.getElementById('mapelNilai').value,
        tugas1: document.getElementById('tugas1').value,
        tugas2: document.getElementById('tugas2').value,
        ulangan: document.getElementById('ulangan').value,
        praktek: document.getElementById('praktek').value
      };
      fetch(scriptURL, {
        method: 'POST',
        body: JSON.stringify(data)
      }).then(res => res.text()).then(alert);
    });
  }
  </script>
</body>
</html>
