<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Aplikasi Absensi & Nilai</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body class="login-body">
  <!-- LOGIN -->
  <div id="loginPage" class="login-box">
    <h1>Login Admin</h1>
    <form id="loginForm">
      <input type="text" id="username" placeholder="Username" required />
      <input type="password" id="password" placeholder="Password" required />
      <button type="submit">Masuk</button>
    </form>
    <p id="loginError" style="color: red;"></p>
  </div>

  <!-- DASHBOARD -->
  <div id="dashboardPage" class="dashboard hidden">
    <h2>Selamat Datang, Admin</h2>
    <div class="menu-grid">
      <button onclick="showPage('absensiPage')" class="menu-card">Input Absensi</button>
      <button onclick="showPage('nilaiPage')" class="menu-card">Input Nilai</button>
      <button onclick="showPage('laporanPage')" class="menu-card">Lihat Laporan</button>
      <button onclick="logout()" class="menu-card danger">Keluar</button>
    </div>
  </div>

  <!-- ABSENSI -->
  <div id="absensiPage" class="form-container hidden">
    <h2>Form Absensi</h2>
    <form id="absensiForm">
      <input type="month" id="bulan" required>
      <input type="date" id="tanggal" required>
      <select id="nama" required></select>
      <select id="kelas" required></select>
      <select id="mapel" required>
        <option value="">Pilih Mapel</option>
        <option>Dasar-dasar DKV</option>
        <option>Informatika</option>
      </select>
      <select id="status" required>
        <option>Hadir</option>
        <option>Izin</option>
        <option>Sakit</option>
        <option>Alpha</option>
      </select>
      <button type="submit">Simpan</button>
    </form>
    <div id="absensiData"></div>
  </div>

  <!-- NILAI -->
  <div id="nilaiPage" class="form-container hidden">
    <h2>Form Nilai</h2>
    <form id="nilaiForm">
      <input type="month" id="bulanNilai" required>
      <select id="namaNilai" required></select>
      <select id="kelasNilai" required></select>
      <select id="mapelNilai" required>
        <option value="">Pilih Mapel</option>
        <option>Dasar-dasar DKV</option>
        <option>Informatika</option>
      </select>
      <input type="number" id="tugas1" placeholder="Tugas 1" required>
      <input type="number" id="tugas2" placeholder="Tugas 2" required>
      <input type="number" id="ulangan" placeholder="Ulangan" required>
      <input type="number" id="praktek" placeholder="Praktek" required>
      <button type="submit">Simpan</button>
    </form>
    <div id="nilaiData"></div>
  </div>

  <!-- LAPORAN -->
  <div id="laporanPage" class="form-container hidden">
    <h2>Laporan Absensi dan Nilai</h2>
    <div id="laporanAbsensi">Tampilkan laporan di sini...</div>
    <div id="laporanNilai">Tampilkan laporan di sini...</div>
  </div>

  <script>
    const scriptURL = 'https://script.google.com/macros/s/AKfycbzQIH6WrrYa2y9sfxgw7_kujhmFgs9rCoSYbfTmmfSoJhr1aEvHmbvyjoTXPpvWXHxT/exec';

    document.addEventListener('DOMContentLoaded', () => {
      showPage('loginPage');
    });

    function showPage(pageId) {
      document.querySelectorAll('body > div').forEach(el => el.classList.add('hidden'));
      document.getElementById(pageId).classList.remove('hidden');
    }

    function logout() {
      showPage('loginPage');
    }

    const loginForm = document.getElementById('loginForm');
    if (loginForm) {
      loginForm.addEventListener('submit', function (e) {
        e.preventDefault();
        const user = document.getElementById('username').value;
        const pass = document.getElementById('password').value;
        if (user === 'admin' && pass === '12345') {
          showPage('dashboardPage');
          fetchSiswa();
        } else {
          document.getElementById('loginError').textContent = 'Login gagal. Username atau password salah.';
        }
      });
    }

    function fetchSiswa() {
      fetch(`${scriptURL}?action=getsiswa`)
        .then(res => res.json())
        .then(data => {
          const namaList = [document.getElementById('nama'), document.getElementById('namaNilai')];
          const kelasList = [document.getElementById('kelas'), document.getElementById('kelasNilai')];

          namaList.forEach(sel => sel.innerHTML = '<option value="">Pilih Nama</option>');
          kelasList.forEach(sel => sel.innerHTML = '<option value="">Pilih Kelas</option>');

          const kelasSet = new Set();

          data.forEach(siswa => {
            namaList.forEach(namaSel => {
              const opt = document.createElement('option');
              opt.value = siswa.nama;
              opt.textContent = siswa.nama;
              namaSel.appendChild(opt);
            });
            if (!kelasSet.has(siswa.kelas)) {
              kelasSet.add(siswa.kelas);
              kelasList.forEach(kelasSel => {
                const opt = document.createElement('option');
                opt.value = siswa.kelas;
                opt.textContent = siswa.kelas;
                kelasSel.appendChild(opt);
              });
            }
          });
        });
    }

    document.getElementById('absensiForm')?.addEventListener('submit', function (e) {
      e.preventDefault();
      const data = {
        action: 'addAbsensi',
        bulan: document.getElementById('bulan').value,
        tanggal: document.getElementById('tanggal').value,
        nama: document.getElementById('nama').value,
        kelas: document.getElementById('kelas').value,
        mapel: document.getElementById('mapel').value,
        status: document.getElementById('status').value
      };
      fetch(scriptURL, {
        method: 'POST',
        body: JSON.stringify(data)
      }).then(res => res.text()).then(alert);
    });

    document.getElementById('nilaiForm')?.addEventListener('submit', function (e) {
      e.preventDefault();
      const data = {
        action: 'addNilai',
        bulan: document.getElementById('bulanNilai').value,
        nama: document.getElementById('namaNilai').value,
        kelas: document.getElementById('kelasNilai').value,
        mapel: document.getElementById('mapelNilai').value,
        tugas1: document.getElementById('tugas1').value,
        tugas2: document.getElementById('tugas2').value,
        ulangan: document.getElementById('ulangan').value,
        praktek: document.getElementById('praktek').value
      };
      fetch(scriptURL, {
        method: 'POST',
        body: JSON.stringify(data)
      }).then(res => res.text()).then(alert);
    });
  </script>
</body>
</html>
